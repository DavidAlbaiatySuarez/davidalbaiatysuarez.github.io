package detectors;

import java.util.List;
import com.github.javaparser.ast.body.MethodDeclaration;
import com.github.javaparser.ast.expr.MethodCallExpr;
import com.github.javaparser.ast.visitor.VoidVisitorAdapter;

/**
 * Class that detects polymorphic recursion in java program code.
 * 
 * @author David Al Baiaty Suarez (2474364A)
 *
 */
public class RecursionDetector extends VoidVisitorAdapter<List<String>>{
	
	@Override
	public void visit(MethodDeclaration md, List<String> collector) {
		super.visit(md,  collector);
		
		
		md.findAll(MethodCallExpr.class).forEach(statement ->{
			// If condition met, polymorphic recursion detected
			if(statement.getNameAsString().equals(md.getNameAsString())){
				// Get method name as string
				String methodName = md.getNameAsString();
				// Get start line of the recursion 
				int begin = statement.getRange().get().begin.line;
				// Get end line of the recursion 
				int end = statement.getRange().get().end.line;
				
				collector.add(methodName+","+begin+","+end);
			}
		});
	}
	
}
